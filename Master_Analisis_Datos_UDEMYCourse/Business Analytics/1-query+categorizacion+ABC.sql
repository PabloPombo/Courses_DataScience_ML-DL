SELECT  t1.productCode, t1.productName AS producto, t1.productLine,SUM(t2.quantityOrdered*t2.priceEach) AS total_ventas, (SUM(t2.quantityOrdered*t2.priceEach) - SUM(t2.quantityOrdered*t1.buyPrice)) AS margen_ganancia FROM products as t1 JOIN orderdetails as t2 ON t1.productCode = t2.productCode JOIN orders as t3 ON t2.orderNumber = t3.orderNumber WHERE t3.status = "Shipped" GROUP BY t1.productCode, t1.productName